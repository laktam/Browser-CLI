/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";async function t(){let t=await chrome.tabs.query({}),e=[];console.log(t);let a=1;for(let o of t){let t="("+a+") "+o.title+" : "+o.url;o.highlighted&&(t+=" *"),e.push(t),a++}return e}function e(t){return t.split(" ")}async function a(t){let e=await chrome.tabs.query({});t=t.map((t=>Number.parseInt(t)-1));let a=[];for(let o of t)a.push(e[o].id);return console.log("tab ids in function ",a),a}chrome.runtime.onMessage.addListener((function(o,i,r){return"command"===o.action&&(console.log(o.command),async function(o){const i=function(t){return t.split(" ")}(o);let r,n=i[0],c=i[1];await async function(){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return console.log(t.id),t.id}(),"ls"==n?r=await t():"cd"==n?r=await async function(t){let e=await chrome.tabs.query({});chrome.tabs.update(e[Number.parseInt(t)-1].id,{active:!0})}(c):"rm"==n?r=await async function(t){let a=e(t);if("-g"==a[1]){let[t]=await chrome.tabGroups.query({title:a[2].slice(1,a[2].length-1)});console.log("group to ungroup ",t);let e=t.id,o=await chrome.tabs.query({}),i=[];for(let t of o)t.groupId==e&&i.push(t.id);await chrome.tabs.remove(i)}else{let e=await chrome.tabs.query({});chrome.tabs.remove(e[Number.parseInt(t)-1].id)}}(o):"find"==n?r=await async function(e){e=e.slice(1,e.length-1),console.log("arg ",e);let a=await t();return a=a.filter((t=>t.includes(e))),console.log("found tabs ",a),a}(c):"pwd"==n?r=await async function(){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return t.title+" : "+t.url}():"create"==n?r=await async function(t){let a=e(t),o=!1,i="";"--active"==a[1]||"-a"==a[1]?(o=!0,i=a[2].slice(1,a[2].length-1)):i=a[1].slice(1,a[1].length-1),i.includes("http")||(i="https://"+i),chrome.tabs.create({active:o,url:i})}(o):"group"==n?r=await async function(t){let o,i=e(t);if(await chrome.tabs.query({}),"--new"==i[1]){let[t,e,r,...n]=i;r=i[2].slice(1,i[2].length-1);let c=await a(n);o=await chrome.tabs.group({tabIds:c}),await chrome.tabGroups.update(o,{collapsed:!1,title:r})}else if("--name"==i[1]){let[t,e,o,...r]=i;o=i[2].slice(1,i[2].length-1);let n=await a(r),c=await chrome.tabGroups.query({title:o});console.log("groups found ",c),await chrome.tabs.group({tabIds:n,groupId:c[0].id})}}(o):"ungroup"==n&&(r=await async function(t){let o=e(t);if("--tabs"==o[1]||"-t"==o[1]){let[t,e,...i]=o,r=await a(i);await chrome.tabs.ungroup(r)}else if("-g"==o[1]){let[t]=await chrome.tabGroups.query({title:o[2].slice(1,o[2].length-1)});console.log("group to ungroup ",t);let e=t.id,a=await chrome.tabs.query({}),i=[];for(let t of a)t.groupId==e&&i.push(t.id);await chrome.tabs.ungroup(i)}}(o)),chrome.runtime.sendMessage({action:n,data:r})}(o.command),r()),!0}))})();