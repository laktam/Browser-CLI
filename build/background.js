(()=>{"use strict";async function e(e){if(console.log(e),null==e["-g"]){let e=await chrome.tabs.query({}),t=[];console.log(e);let a=1;for(let n of e){let e="("+a+") "+n.title+" : "+n.url;n.highlighted&&(e+=" *"),t.push(e),a++}return t}{const e=await chrome.tabGroups.query({}),t=await chrome.tabs.query({});return e.map((e=>({...e,tabs:t.filter((t=>t.groupId===e.id))})))}}async function t(e){let t=await chrome.tabs.query({});e=e.map((e=>Number.parseInt(e)-1));let a=[];for(let n of e)a.push(t[n].id);return console.log("tab ids in function ",a),a}async function a(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return console.log(e.id),e.id}console.log("log in content script"),chrome.runtime.onMessage.addListener((function(n,o,r){return"command"===n.action&&(console.log(n.command),async function(n){const o=function(e){let t=(e=e.replace("s{2,}"," ")).split(" ");const a={command:e=t[0]};if(t.length>1){let e=0;for(;e<t.length;)t[e].startsWith("-")&&(e+1<t.length&&!t[e+1].startsWith("-")?(a[t[e]]=t[e+1],e++):a[t[e]]="true"),e++;const n=t.findLastIndex((e=>e.startsWith("-")))+2;n<t.length&&(a.arguments=t.slice(n));const o=t.findLastIndex((e=>e.startsWith("-")))+1;o<t.length&&(a.allLastArguments=t.slice(o))}return console.log("command object",a),a}(n);let r;"ls"==o.command?r=await e(o):"cd"==o.command?r=await async function(e){let t=await chrome.tabs.query({});a().then((e=>chrome.tabs.sendMessage(e,{action:"cd"}))),chrome.tabs.update(t[Number.parseInt(e.arguments[0])-1].id,{active:!0})}(o):"rm"==o.command?r=await async function(e){if(null!=e["-g"]){let[t]=await chrome.tabGroups.query({title:e["-g"].slice(1,e["-g"].length-1)}),a=t.id,n=await chrome.tabs.query({}),o=[];for(let e of n)e.groupId==a&&o.push(e.id);await chrome.tabs.remove(o)}else{let t=await chrome.tabs.query({});chrome.tabs.remove(t[Number.parseInt(e.arguments[0])-1].id)}}(o):"find"==o.command?r=await async function(t){let a=t.arguments[0].slice(1,t.arguments[0].length-1);a=a.toLowerCase();let n=await e();return n=n.map((e=>e.toLowerCase())),n=n.filter((e=>e.includes(a))),n}(o):"pwd"==o.command?r=await async function(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e.title+" : "+e.url}():"create"==o.command?r=await async function(e){let t=!1,a="";null!=e["--active"]?(t=!0,a=e["--active"].slice(1,e["--active"].length-1)):null!=e["-a"]?(t=!0,a=e["-a"].slice(1,e["-a"].length-1)):a=e.arguments[0].slice(1,e.arguments[0].length-1),a=a.includes(".")?"http://"+a:"https://www.google.com/search?q="+a,chrome.tabs.create({active:t,url:a})}(o):"group"==o.command?r=await async function(e){let a;if(null!=e["--new"]){let n=e["--new"].slice(1,e["--new"].length-1),o=await t(e.arguments);a=await chrome.tabs.group({tabIds:o}),await chrome.tabGroups.update(a,{collapsed:!1,title:n})}else if(null!=e["--name"]){let a=e["--name"].slice(1,e["--name"].length-1),n=await t(e.arguments),o=await chrome.tabGroups.query({title:a});console.log("groups found ",o),await chrome.tabs.group({tabIds:n,groupId:o[0].id})}}(o):"ungroup"==o.command?r=await async function(e){if(null!=e["--tabs"]||null!=e["-t"]){let a=e.allLastArguments,n=await t(a);await chrome.tabs.ungroup(n)}else if(null!=e["--name"]){let t=e["--name"].slice(1,e["--name"].length-1),[a]=await chrome.tabGroups.query({title:t}),n=a.id,o=await chrome.tabs.query({}),r=[];for(let e of o)e.groupId==n&&r.push(e.id);await chrome.tabs.ungroup(r)}}(o):"clear"==o.command?r="Terminal cleared":"help"==o.command?r="Help command executed":(r=o.command,o.command="no-command-found"),a().then((e=>{chrome.tabs.sendMessage(e,{action:o.command,data:r,command:n,commandObj:o})}))}(n.command),r()),!0})),chrome.commands.onCommand.addListener((e=>{console.log("Command triggered:",e),"open-terminal"===e&&(console.log("shortcut clicked"),a().then((e=>{chrome.tabs.sendMessage(e,{shortcut:"open-terminal"},(e=>{chrome.runtime.lastError?console.error(`Error injecting HTML into tab ${tab.id}: ${chrome.runtime.lastError.message}`):console.log(`Response from tab ${tab.id}:`,e)}))})))}))})();