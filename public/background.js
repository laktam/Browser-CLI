(()=>{"use strict";async function t(){let t=await chrome.tabs.query({}),e=[];console.log(t);let a=1;for(let o of t){let t="("+a+") "+o.title+" : "+o.url;o.highlighted&&(t+=" *"),e.push(t),a++}return e}function e(t){return t.split(" ")}async function a(t){let e=await chrome.tabs.query({});t=t.map((t=>Number.parseInt(t)-1));let a=[];for(let o of t)a.push(e[o].id);return console.log("tab ids in function ",a),a}async function o(){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return console.log(t.id),t.id}function n(t,e){chrome.tabs.sendMessage(t,{action:e})}let i={};chrome.runtime.onMessage.addListener((function(n,i,r){return"command"===n.action&&(console.log(n.command),async function(n){const i=function(t){return t.split(" ")}(n);let r,c=i[0],l=i[1],s=await o();"ls"==c?r=await t():"cd"==c?r=await async function(t){let e=await chrome.tabs.query({});chrome.tabs.update(e[Number.parseInt(t)-1].id,{active:!0})}(l):"rm"==c?r=await async function(t){let a=e(t);if("-g"==a[1]){let[t]=await chrome.tabGroups.query({title:a[2].slice(1,a[2].length-1)});console.log("group to ungroup ",t);let e=t.id,o=await chrome.tabs.query({}),n=[];for(let t of o)t.groupId==e&&n.push(t.id);await chrome.tabs.remove(n)}else{let e=await chrome.tabs.query({});chrome.tabs.remove(e[Number.parseInt(t)-1].id)}}(n):"find"==c?r=await async function(e){e=e.slice(1,e.length-1),console.log("arg ",e);let a=await t();return a=a.filter((t=>t.includes(e))),console.log("found tabs ",a),a}(l):"pwd"==c?r=await async function(){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return t.title+" : "+t.url}():"create"==c?r=await async function(t){let a=e(t),o=!1,n="";"--active"==a[1]||"-a"==a[1]?(o=!0,n=a[2].slice(1,a[2].length-1)):n=a[1].slice(1,a[1].length-1),n.includes("http")||(n="https://"+n),chrome.tabs.create({active:o,url:n})}(n):"group"==c?r=await async function(t){let o,n=e(t);if(await chrome.tabs.query({}),"--new"==n[1]){let[t,e,i,...r]=n;i=n[2].slice(1,n[2].length-1);let c=await a(r);o=await chrome.tabs.group({tabIds:c}),await chrome.tabGroups.update(o,{collapsed:!1,title:i})}else if("--name"==n[1]){let[t,e,o,...i]=n;o=n[2].slice(1,n[2].length-1);let r=await a(i),c=await chrome.tabGroups.query({title:o});console.log("groups found ",c),await chrome.tabs.group({tabIds:r,groupId:c[0].id})}}(n):"ungroup"==c&&(r=await async function(t){let o=e(t);if("--tabs"==o[1]||"-t"==o[1]){let[t,e,...n]=o,i=await a(n);await chrome.tabs.ungroup(i)}else if("-g"==o[1]){let[t]=await chrome.tabGroups.query({title:o[2].slice(1,o[2].length-1)});console.log("group to ungroup ",t);let e=t.id,a=await chrome.tabs.query({}),n=[];for(let t of a)t.groupId==e&&n.push(t.id);await chrome.tabs.ungroup(n)}}(n)),chrome.tabs.sendMessage(s,{action:c,data:r})}(n.command),r()),!0})),chrome.commands.onCommand.addListener((function(t){return"open-terminal"===t&&o().then((t=>{console.log("open terminal command,  tabsWithOpenTerminal[id]:",i[t]),null==i[t]||0==i[t]?(i[t]=!0,n(t,"open-terminal")):!0===i[t]&&(i[t]=!1,n(t,"close-terminal"))})),!0}))})();